unarchive-submissions.sh
========================


The script takes an archive generated by moodle when using the "Download all submissions" action for an assignment, and processes it as described by the arguments.

Usage:
`unarchive-submissions.sh [OPTION] submission-archive [selection] [select-file]`


By default, a call of `unarchive-submissions.sh assignment.zip` creates in the current directory a directory with the same name as the archive, which contains a directory for each student. By default, per-student directories are named `Name SURNAME`, but the order can be changed with the `-np` option. The names of the per-student directories can be further altered with the `-pre` option for a prefix and the `-post` option for a postfix.

If students have both _online text_ and _file_ submissions, by default these are treated separately. If the `-a` option is present, they are combined.

Students can be filtered by using the `selection` argument after the archive name, which is a file containing a list of names, on on each line, in the form _Firstname-Firstname-Firstname LASTNAME-LASTNAME_ (or the same as it is on moodle). The `all` value can be used to select all students.

Individual files from the submissions can be selected via the last argument, as an exact file (e.g. `"file.txt"`), as a pattern (e.g. `"*.py"`) or as an assembly of patterns (e.g. `"*.py|*.ipynb|*.txt"`). All the files will be placed together in the output directory, each file being prefixed with the name of the student (depending on the presence of the `-np` option). More precisely, the name of the folder is used, as produced before the file selection.

Verbose output of the script is flushed to `log.txt`. The file can be changed by using the `-log` option.

If the `-keep` option is used, the sript keeps the intermediate directories created during processing, which have the following structure:

current directory
|
└─ assignment		// a directory with the same name as the archive
    |
    └─ 1original
    └─ 2unarchived
    └─ 3selected
    └─ 4files -- present only of the `select-file` argument is present.
    

`1original` contains the original, unzipped, content of the archive, with 1 directory per student.
`2unarchived` contains one directory per student, with the following properties:
 - the name of the directory is `Name SURNAME`
 - if the student uploaded at least one archive, the first archive is unzipped
  - this works for `.zip` and `.tar.gz` / `.tgz` archives
  - only the first archive is unzipped in order to avoid potential problems with overwrites
`3selected` contains the _selected_ students, if any such selection was made, or again all students
 - if the `-np` option was used, the names of directories are `SURNAME Name`
